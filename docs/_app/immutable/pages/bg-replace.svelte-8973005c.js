import{S as me,i as ge,s as ve,e as O,t as V,c as I,a as D,h as C,d as r,g as j,G as d,j as se,k as R,K as be,m as U,b as J,L as ie,f as W,M as $,N as ee,n as le,O as oe,P as ye,w as ke,Q as Ee,R as ce,T as re}from"../chunks/index-b8ce0743.js";import{B as ue,r as Oe,C as Ie}from"../chunks/detector-55a96cce.js";import"../chunks/preload-helper-8983ef1c.js";function fe(n,e,t){const a=n.slice();return a[15]=e[t],a}function he(n,e,t){const a=n.slice();return a[18]=e[t],a}function Te(n){let e;return{c(){e=V("\u958B\u59CB")},l(t){e=C(t,"\u958B\u59CB")},m(t,a){j(t,e,a)},d(t){t&&r(e)}}}function De(n){let e;return{c(){e=V("\u505C\u6B62")},l(t){e=C(t,"\u505C\u6B62")},m(t,a){j(t,e,a)},d(t){t&&r(e)}}}function de(n){let e,t;return{c(){e=O("option"),t=V("\u30C7\u30D0\u30A4\u30B9\u306A\u3057"),this.h()},l(a){e=I(a,"OPTION",{});var c=D(e);t=C(c,"\u30C7\u30D0\u30A4\u30B9\u306A\u3057"),c.forEach(r),this.h()},h(){e.__value="",e.value=e.__value},m(a,c){j(a,e,c),d(e,t)},p:le,d(a){a&&r(e)}}}function _e(n){let e,t=n[18].label+"",a,c;return{c(){e=O("option"),a=V(t),this.h()},l(s){e=I(s,"OPTION",{});var o=D(e);a=C(o,t),o.forEach(r),this.h()},h(){e.__value=c=n[18].deviceId,e.value=e.__value},m(s,o){j(s,e,o),d(e,a)},p(s,o){o&4&&t!==(t=s[18].label+"")&&se(a,t),o&4&&c!==(c=s[18].deviceId)&&(e.__value=c,e.value=e.__value)},d(s){s&&r(e)}}}function pe(n){let e,t=n[15]+"",a,c;return{c(){e=O("option"),a=V(t),this.h()},l(s){e=I(s,"OPTION",{});var o=D(e);a=C(o,t),o.forEach(r),this.h()},h(){e.__value=c=n[15],e.value=e.__value},m(s,o){j(s,e,o),d(e,a)},p(s,o){o&8&&t!==(t=s[15]+"")&&se(a,t),o&8&&c!==(c=s[15])&&(e.__value=c,e.value=e.__value)},d(s){s&&r(e)}}}function we(n){let e,t,a,c,s,o,B,_,h,A,T,G,M,H,P,K,q,u,p,f,w,g,E,Q,z;function F(l,m){return l[1].status==="running"?De:Te}let Y=F(n),S=Y(n),N=n[2].items,b=[];for(let l=0;l<N.length;l+=1)b[l]=_e(he(n,N,l));let v=null;N.length||(v=de());let X=n[3].items,y=[];for(let l=0;l<X.length;l+=1)y[l]=pe(fe(n,X,l));return{c(){e=R(),t=O("h2"),a=V("\u80CC\u666F\u7F6E\u63DB"),c=R(),s=O("div"),o=O("button"),S.c(),_=R(),h=O("select");for(let l=0;l<b.length;l+=1)b[l].c();v&&v.c(),A=R(),T=O("select");for(let l=0;l<y.length;l+=1)y[l].c();G=R(),M=O("input"),H=R(),P=O("span"),K=V("\u4F53\u8A8D\u8B58\u30D5\u30EC\u30FC\u30E0\u30EC\u30FC\u30C8: "),q=V(n[5]),u=V("fps"),p=R(),f=O("div"),w=O("canvas"),g=R(),E=O("video"),this.h()},l(l){be('[data-svelte="svelte-17eho2j"]',document.head).forEach(r),e=U(l),t=I(l,"H2",{});var i=D(t);a=C(i,"\u80CC\u666F\u7F6E\u63DB"),i.forEach(r),c=U(l),s=I(l,"DIV",{class:!0});var k=D(s);o=I(k,"BUTTON",{type:!0,class:!0});var ne=D(o);S.l(ne),ne.forEach(r),_=U(k),h=I(k,"SELECT",{});var te=D(h);for(let L=0;L<b.length;L+=1)b[L].l(te);v&&v.l(te),te.forEach(r),A=U(k),T=I(k,"SELECT",{});var ae=D(T);for(let L=0;L<y.length;L+=1)y[L].l(ae);ae.forEach(r),G=U(k),M=I(k,"INPUT",{type:!0,accept:!0}),H=U(k),P=I(k,"SPAN",{});var Z=D(P);K=C(Z,"\u4F53\u8A8D\u8B58\u30D5\u30EC\u30FC\u30E0\u30EC\u30FC\u30C8: "),q=C(Z,n[5]),u=C(Z,"fps"),Z.forEach(r),k.forEach(r),p=U(l),f=I(l,"DIV",{});var x=D(f);w=I(x,"CANVAS",{}),D(w).forEach(r),g=U(x),E=I(x,"VIDEO",{style:!0}),D(E).forEach(r),x.forEach(r),this.h()},h(){document.title="\u80CC\u666F\u7F6E\u63DB",o.disabled=B=!n[0],J(o,"type","button"),J(o,"class","svelte-1gbhd3m"),n[2].selected===void 0&&ie(()=>n[9].call(h)),n[3].selected===void 0&&ie(()=>n[10].call(T)),J(M,"type","file"),J(M,"accept","png,jpg,jpeg"),J(s,"class","ActionBox svelte-1gbhd3m"),E.playsInline=!0,W(E,"-webkit-transform","scaleX(-1)"),W(E,"transform","scaleX(-1)"),W(E,"visibility","hidden"),W(E,"width","auto"),W(E,"height","auto")},m(l,m){j(l,e,m),j(l,t,m),d(t,a),j(l,c,m),j(l,s,m),d(s,o),S.m(o,null),d(s,_),d(s,h);for(let i=0;i<b.length;i+=1)b[i].m(h,null);v&&v.m(h,null),$(h,n[2].selected),d(s,A),d(s,T);for(let i=0;i<y.length;i+=1)y[i].m(T,null);$(T,n[3].selected),d(s,G),d(s,M),d(s,H),d(s,P),d(P,K),d(P,q),d(P,u),j(l,p,m),j(l,f,m),d(f,w),n[11](w),d(f,g),d(f,E),n[12](E),Q||(z=[ee(o,"click",n[6]),ee(h,"change",n[9]),ee(T,"change",n[10]),ee(M,"change",n[7])],Q=!0)},p(l,[m]){if(Y!==(Y=F(l))&&(S.d(1),S=Y(l),S&&(S.c(),S.m(o,null))),m&1&&B!==(B=!l[0])&&(o.disabled=B),m&4){N=l[2].items;let i;for(i=0;i<N.length;i+=1){const k=he(l,N,i);b[i]?b[i].p(k,m):(b[i]=_e(k),b[i].c(),b[i].m(h,null))}for(;i<b.length;i+=1)b[i].d(1);b.length=N.length,!N.length&&v?v.p(l,m):N.length?v&&(v.d(1),v=null):(v=de(),v.c(),v.m(h,null))}if(m&4&&$(h,l[2].selected),m&8){X=l[3].items;let i;for(i=0;i<X.length;i+=1){const k=fe(l,X,i);y[i]?y[i].p(k,m):(y[i]=pe(k),y[i].c(),y[i].m(T,null))}for(;i<y.length;i+=1)y[i].d(1);y.length=X.length}m&8&&$(T,l[3].selected),m&32&&se(q,l[5])},i:le,o:le,d(l){l&&r(e),l&&r(t),l&&r(c),l&&r(s),S.d(),oe(b,l),v&&v.d(),oe(y,l),l&&r(p),l&&r(f),n[11](null),n[12](null),Q=!1,ye(z)}}}function je(n){return new Promise(e=>{const t=new FileReader;t.onload=a=>{e(a.target.result)},t.readAsDataURL(n)})}function Be(n,e,t){let a,c,s,o=0,B,_={status:"stopped"},h={items:[],selected:""},A={items:["tfjs","mediapipe"],selected:"tfjs"};ke(async()=>{var f,w;const u=(await navigator.mediaDevices.enumerateDevices()).filter(g=>g.kind==="videoinput"),p=(w=(f=u[0])==null?void 0:f.deviceId)!=null?w:"";t(2,h={items:u,selected:p})}),Ee(()=>{var u,p,f;(u=_.video)==null||u.pause(),(f=(p=_.video)==null?void 0:p.srcObject)==null||f.getVideoTracks().forEach(w=>{w.stop()}),s==null||s.destroy()});function T(){t(1,_={..._,status:_.status==="running"?"stopped":"running"})}async function G(u){var f;const p=(f=u.currentTarget.files)==null?void 0:f[0];!p||(B=await je(p),s==null||s.setMaskBase(B))}async function M(u,p){var z;t(1,_={..._,status:"stopped"});const{video:g}=_;if(!g)return;if(!u){g.pause(),(z=g.srcObject)==null||z.getVideoTracks().forEach(F=>{F.stop()}),g.srcObject=null,t(0,c=void 0);return}const[E,Q]=await Promise.all([navigator.mediaDevices.getUserMedia({audio:!1,video:{width:640,height:480,deviceId:u}}).catch(()=>{alert("\u30AB\u30E1\u30E9\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002")}),ue.init(p),Oe()]);!E||(t(0,c=Q),g.srcObject=E,g.width=640,g.height=480,t(4,a.width=640,a),t(4,a.height=480,a),g.readyState<2&&await new Promise(F=>{g.onloadeddata=F}),g.play(),s==null||s.destroy(),t(8,s=new Ie(g,a,640,480)),B&&s.setMaskBase(B))}function H(){h.selected=ce(this),t(2,h)}function P(){A.selected=ce(this),t(3,A)}function K(u){re[u?"unshift":"push"](()=>{a=u,t(4,a)})}function q(u){re[u?"unshift":"push"](()=>{_.video=u,t(1,_)})}return n.$$.update=()=>{if(n.$$.dirty&12&&h.items.length>0&&M(h.selected,A.selected),n.$$.dirty&259)if(_.status==="running"){if(c){const{stop:u}=c.listen(_.video,async p=>{const f=await ue.toImageData(p);_.status==="running"?s==null||s.applyBgFilter(f):u()},p=>t(5,o=p))}}else s==null||s.clear()},[c,_,h,A,a,o,T,G,s,H,P,K,q]}class Ve extends me{constructor(e){super(),ge(this,e,Be,we,ve,{})}}export{Ve as default};
